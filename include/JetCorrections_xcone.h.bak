#pragma once

#include "UHH2/core/include/AnalysisModule.h"
#include "UHH2/common/include/ObjectIdUtils.h"
#include "UHH2/common/include/Utils.h"
#include "UHH2/JetMETObjects/interface/JetCorrectionUncertainty.h"

class FactorizedJetCorrector;

/// namespace to define some useful filename constants to be used for jet energy corrections
namespace JERFiles {
    //Summer16_23Sep2016_V4_noRes needed for L2Res people
    extern const std::vector<std::string> Summer16_23Sep2016_V4_BCD_L123_noRes_AK4PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_EF_L123_noRes_AK4PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_G_L123_noRes_AK4PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_H_L123_noRes_AK4PFchs_DATA;

    //Summer16_23Sep2016_V4 --> Official JEC recommendation for Moriond17
    extern const std::vector<std::string> Summer16_23Sep2016_V4_BCD_L123_AK4PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_EF_L123_AK4PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_G_L123_AK4PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_H_L123_AK4PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_BCD_L123_AK8PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_EF_L123_AK8PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_G_L123_AK8PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_H_L123_AK8PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_L123_AK4PFchs_MC;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_L123_AK8PFchs_MC;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_BCD_L1RC_AK4PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_EF_L1RC_AK4PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_G_L1RC_AK4PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_H_L1RC_AK4PFchs_DATA;
    extern const std::vector<std::string> Summer16_23Sep2016_V4_L1RC_AK4PFchs_MC; 



}

class JetCorrector_xcone: public uhh2::AnalysisModule {
public:
  explicit JetCorrector_xcone(uhh2::Context & ctx, const std::vector<std::string> & filenames, const std::vector<std::string> & filenames_L1RC = {});
    
    virtual bool process(uhh2::Event & event) override;
    
    virtual ~JetCorrector_xcone();
    
private:
    std::unique_ptr<FactorizedJetCorrector> corrector;
    std::unique_ptr<FactorizedJetCorrector> corrector_L1RC;
    
    JetCorrectionUncertainty* jec_uncertainty;
    int direction = 0; // -1 = down, +1 = up, 0 = nominal
    bool propagate_to_met = false;
    bool used_ak4puppi = false;
    bool used_ak4chs = false;
    bool metprop_possible_ak8chs = false;
    bool metprop_possible_ak8puppi = false;
    bool used_slimmedmet = false;
    bool used_puppimet = false;
    bool used_chsmet = false;
    bool do_metL1RC = false;
    uhh2::Event::Handle<std::vector<TopJet>>h_recfatjets;

};



//// -----------------------------------------------------------------
